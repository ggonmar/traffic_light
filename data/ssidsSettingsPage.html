<html>
<title>[ADMIN] Semaforo de Reunion 2.0 </title>

<head>
  <style type="text/css">
    input[type=radio] {
      vertical-align: text-bottom;
      width: 0.8em;
    }

    label {
      font-size: 0.8em;
    }

    td {
      padding: 0.8em 0em;
    }
  </style>
  <script>
    function addNew() {
      let table = document.getElementById('ssids');
      if(table.rows.length -3 >= 20)
      {
        window.alert("There is a limit of 20 SSIDs to be stored... we think that's enough!");
        return;
      }
      let index = table.rows.length - 3;
      var row = table.insertRow(index);
      row.id = "container_" + index;
      // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);
      var cell3 = row.insertCell(2);

      // Add some text to the new cells:
      cell1.innerHTML = `<input class='ssid' type='text' name='ssid_${index}' placeholder='SSID'/>`;
      cell2.innerHTML = `<input class='pwd' type='password'  name='pwd_${index}' placeholder='Pwd'/>`;
      cell3.innerHTML = `<input class='radio' type='radio'  name='type_${index}' value="standard" checked><label>Standard</label></input><br>` +
        `<input class='radio' type='radio'  name='type_${index}' value="phone"><label>Phone (Tether)</label></input>`;
    }

    function prepareAndSendData() {
      document.body.style.cursor = "wait";
      const form = document.querySelector("form");
      let data = new FormData(form);
      let processedData = [];
      let numberOfElements = document.getElementsByClassName('ssid').length;
      for (let i = 1; i <= numberOfElements; i++) {
        if (data.get("ssid_" + i) === "" && document.getElementById('container_' + i))
          document.getElementById('container_' + i).remove()
        else {
          processedData.push({
            ssid: data.get("ssid_" + i),
            pwd: data.get("pwd_" + i),
            type: data.get("type_" + i) === "phone"
          });
        }
      }
      try {
        fetch("/SSID_SETTINGS_SUBMIT", {
          method: "POST",
          body: JSON.stringify(processedData)
        }).then(res => {
          //          console.log("Request complete! response:", res);
        }).catch(err => { });
      } catch (e) { };
    }

  </script>
</head>
<!--   <body onload=sendJSCall('"+currentColor+"')> -->

<body>
  <h1 id='title'>Administration page</h1>
  <form>
    <table id='ssids' style='border:0px'>
      <tr>
        <th>SSID</th>
        <th>Password</th>
        <th>Wifi Type</th>
      </tr>
      {{existingSSIDs}}
      <tr>
        <td colspan=3 style='text-align:center'>
          <button type="button" onclick="addNew()" id='add-new-button' style='width:100%; height:40px; margin-top:20px'>A&#241;adir otro
            SSID</button>
        </td>
      </tr>
      <tr>
        <td colspan=3 style='text-align:center'>
          <button type="button" onclick="prepareAndSendData()" id='save-all-button' style='width:150px; height:70px; margin-top:30px'>Guardar</button>
        </td>
      </tr>
      <tr>
        <td colspan=3 style='text-align:center'>
          <a href="/"><button type="button" id='return-button' style='width:150px; height:70px; margin-top:10px'>Volver</button></a>
        </td>
      </tr>
    </table>
  </form>
</body>

</html>